#!/bin/dash

set -e

if [ ! -f "st.info" ]; then
   echo "Working directory ( $(pwd) ) is not the root of an st source tree."; exit 1
fi

make clean
git reset --hard
git pull
make clean

wget http://st.suckless.org/patches/st-no-bold-colors.diff
git apply st-no-bold-colors.diff
rm -r st-no-bold-colors.diff

wget http://st.suckless.org/patches/st-solarized-light.diff
git checkout config.def.h
git apply st-solarized-light.diff
rm -f st-solarized-light.diff
cp config.def.h config.h
CFLAGS='-march=corei7' make
cp st ~/bin/st-light

wget http://st.suckless.org/patches/st-solarized-dark.diff
git checkout config.def.h
git apply st-solarized-dark.diff
rm -f st-solarized-dark.diff
cp config.def.h config.h
CFLAGS='-march=corei7' make
cp st ~/bin/st-dark
