#!/bin/dash

# investigate: make MAKEINFO="makeinfo --force"
#
# Also:
# The --without-makeinfo flag doesn't work for me too,
# I have to change MAKEINFO=yes to MAKEINFO=no in the
# Makefile to compile without docs.

if [ ! -f "src/bitmaps/leftptr.xbm" ]; then
   echo "Working directory ( $(pwd) ) is not the root of an emacs source tree."; exit 1
fi

make extraclean
make bootstrap-clean

set -e
git reset --hard
git clean -xdf
git pull --rebase
set +e

./autogen.sh all

# Run the configure script
# (Add   --with-pgtk for Wayland)

./configure \
  --prefix=/usr/local/emacs \
  --program-transform-name='s/^ctags$/ctags.emacs/' \
  --disable-year2038 \
  --disable-acl \
  --with-modules \
  --with-json \
  --with-file-notification \
  --with-native-compilation \
  --with-xwidgets \
  >/tmp/config

#  --with-x-toolkit=athena \

compile-emacs >/tmp/compile
