#!/bin/dash

# investigate: make MAKEINFO="makeinfo --force"
#
# Also:
# The --without-makeinfo flag doesn't work for me too,
# I have to change MAKEINFO=yes to MAKEINFO=no in the
# Makefile to compile without docs.

set -e

if [ ! -f "src/bitmaps/leftptr.xbm" ]; then
   echo "Working directory ( $(pwd) ) is not the root of an emacs source tree."; exit 1
fi

set +e
make extraclean
make bootstrap-clean
set -e

git reset --hard
git clean -xdf
git pull --rebase

# rm -r lisp/cedet test/cedet

./autogen.sh all

set +e
#CFLAGS='-march=native -mfpmath=387 -O3 -no-pie' ./configure --prefix=/usr/local/emacs --enable-link-time-optimization
CFLAGS='-march=native -mfpmath=387 -O3 -no-pie' ./configure --prefix=/usr/local/emacs

# CFLAGS='-march=native -mfpmath=387 -O3 -no-pie' make bootstrap

compile-emacs
