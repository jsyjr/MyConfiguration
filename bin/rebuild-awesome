#!/bin/dash

set -e

if [ ! -f "awesome-version-internal.h.in" ]; then
   echo "Working directory ( $(pwd) ) is not the root of an awesome source tree."; exit 1
fi

git reset --hard
git pull
sed -i.bak \
    -e 's/-O1/-O2 -march=corei7/g' \
  awesomeConfig.cmake
rm -rf ./.build-*
make clean
make
chmod a+w ./.build-*
( cd build && sudo make install )
